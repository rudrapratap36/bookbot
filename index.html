<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nikita Chatbot - Watson Direct</title>
<style>
  body { font-family: Arial; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; background:#f0f2f5; }
  .chat-container { width:400px; background:white; border-radius:10px; display:flex; flex-direction:column; box-shadow:0 4px 10px rgba(0,0,0,0.2); overflow:hidden; }
  .chat-box { flex:1; padding:15px; overflow-y:auto; }
  .chat-message { margin:8px 0; padding:10px; border-radius:8px; max-width:75%; }
  .user { background:#007bff; color:white; align-self:flex-end; }
  .bot { background:#eee; align-self:flex-start; }
  .input-area { display:flex; border-top:1px solid #ddd; }
  .input-area input { flex:1; padding:10px; border:none; outline:none; }
  .input-area button { padding:10px 15px; border:none; background:#007bff; color:white; cursor:pointer; }
</style>
</head>
<body>
<div class="chat-container">
  <div class="chat-box" id="chat-box"></div>
  <div class="input-area">
    <input type="text" id="user-input" placeholder="Type a message...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
const assistantId = "566d4c72-9802-42a1-95ab-f215822b8d08";
const apiKey = "7zLgxDJgTn-lKvodDO2sT9ZN4t7hYzPckl6G0pwBjSNB";
const instanceUrl = "https://api.au-syd.assistant.watson.cloud.ibm.com/instances/a87f2d76-6752-42b1-a9ab-fd0d71df8a55";

// Base64 encode for Basic Auth
const auth = btoa("apikey:" + apiKey);
let sessionId = null;

// Create Watson session
async function createSession() {
  const res = await fetch(`${instanceUrl}/v2/assistants/${assistantId}/sessions`, {
    method: "POST",
    headers: { "Authorization": "Basic " + auth, "Content-Type": "application/json" }
  });
  const data = await res.json();
  sessionId = data.session_id;
}
createSession();

async function sendMessage() {
  const inputBox = document.getElementById("user-input");
  const message = inputBox.value.trim();
  if (!message || !sessionId) return;

  const chatBox = document.getElementById("chat-box");
  chatBox.innerHTML += `<div class="chat-message user">${message}</div>`;
  chatBox.scrollTop = chatBox.scrollHeight;
  inputBox.value = "";

  // Send message to Watson Assistant
  const res = await fetch(`${instanceUrl}/v2/assistants/${assistantId}/sessions/${sessionId}/message`, {
    method: "POST",
    headers: { "Authorization": "Basic " + auth, "Content-Type": "application/json" },
    body: JSON.stringify({ input: { message_type: "text", text: message } })
  });
  const data = await res.json();

  let reply = "Sorry, I didnâ€™t understand that.";
  if (data.output && data.output.generic && data.output.generic.length > 0) {
    reply = data.output.generic[0].text;
  }

  chatBox.innerHTML += `<div class="chat-message bot">${reply}</div>`;
  chatBox.scrollTop = chatBox.scrollHeight;
}
</script>
</body>
</html>
